# SOW: 選択週同期機能の実装 (Phase 3)

## 1. 背景と目的

現状の手動同期は、常に全期間のデータを対象とするため、日々の少しの変更を反映させたい場合に処理が重く、非効率である。
本作業は、ユーザーが指定した1週間分のデータのみをGoogle Sheetsから高速に同期できる「選択週同期」機能を新たに実装し、日々の運用効率を大幅に向上させることを目的とする。

## 2. 作業範囲 (Scope of Work)

### 2.1. バックエンド開発

-   **APIエンドポイントの作成:**
    -   `POST /api/recruitment/sync-week` を新規に作成する。
    -   リクエストボディで対象の週 (`year`, `month`, `weekInMonth`) を受け取る。
    -   Google Sheets APIを呼び出し、指定された週��該当するデータのみを取得する。
    -   取得したデータで、Firestoreの`applications`コレクションと`weekly_reports`コレクションの該当週のドキュメントのみを更新（Upsert）する。
    -   処理の成功または失敗を示すレスポンスを返す。

### 2.2. フロントエンド開発

-   **UIコンポーネントの変更:**
    -   `components/recruitment-dashboard.tsx` 内のデータ管理セクションのボタンを`[選択週を同期]`と`[全体を同期]`に分離する。
-   **状態管理とAPI連携:**
    -   `[選択週を同期]` ボタンクリック時に、現在選択されている週の情報を取得する。
    -   新しいAPIエンドポイント (`/api/recruitment/sync-week`) にPOSTリクエストを送信する。
    -   API処理中は、ボタンを無効化し、ローディング表示を行う。
    -   APIから成功レスポンスを受け取った後、`refetch` を呼び出し、画面の表示を更新する。
    -   エラーが発生した場合は、トースト通知でユーザーに知らせる。

### 2.3. ドキュメント

-   本SOWの作成を��って、事前ドキュメントの更新は完了とする。

## 3. 作業範囲外 (Out of Scope)

-   既存の全体同期機能 (`/api/recruitment/sync`) のロジック変更。
-   レポートの集計ロジックの変更。
-   単体テストおよびE2Eテストコードの作成。

## 4. 成果物

1.  **ソースコード:**
    -   機能実装が完了し、指定ブランチにマージされたフロントエンドおよびバックエンドのコード。
2.  **ドキュメント:**
    -   本SOW (`docs/SOW_Implementation_Phase_3.md`)。

## 5. 開発上の絶対的ルール
-   本件の開発は、`docs/GEMINI_RULES.md` に記載されたルールに厳密に従うものとする。
