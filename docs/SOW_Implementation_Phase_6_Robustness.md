# SOW: 施策管理機能の堅牢性向上 (Phase 6)

## 1. 背景と目的

現状の施策管理機能は、正常系の動作はするものの、ユーザーの入力パターン（例: 日付を空にするなど）によっては、予期せぬサーバーエラーを引き起こし、UIがクラッシュする問題が確認されている。
本作業は、APIとフロントエンドの両方で入力値の検証とエラーハンドリングを強化し、あらゆる入力パターンにおいて安定して動作する、堅牢なシステムを構築することを目的とする。

## 2. 作業範囲 (Scope of Work)

### 2.1. APIの堅牢性向上

-   **2.1.1. 入力値のバリデーション強化 (`/api/initiatives`)**
    -   `POST` (新規作成) APIに、サーバーサイドでの入力値バリデーションを導入する。
    -   `title`, `issue`, `action` などの必須項目が空でないことを確認する。
    -   バリデーションに失敗した場合は、ステータスコード `400 Bad Request` と共に、どの項目に問題があるかを示す明確なエラーメッセージを返す。

-   **2.1.2. 日付処理の修正 (`/api/initiatives`, `/api/initiatives/[id]`)**
    -   `POST` および `PUT` APIにおいて、フロントエンドから送られてくる `dueDate` を安全に処理する。
    -   `dueDate` が空文字列または `null` の場合は、データベースに `null` を保存する。
    -   不正な日付形式の場合は、バリデーションエラーとして処理する。これにより、`Invalid Date` によるサーバークラッシュを完全に防ぐ。

### 2.2. フロントエンドの改善

-   **2.2.1. APIエラーのハンドリング強化 (`components/initiatives-dashboard-v2.tsx`)**
    -   `handleFormSubmit` 関数を修正し、APIから `400 Bad Request` などのエラーレスポンスが返ってきた場合に、その内容をユーザーに分かりやすくトース���通知で表示する。
    -   これにより、「保存に失敗しました」という曖昧なメッセージではなく、「タイトルは必須です」といった具体的なフィードバックを可能にする。

-   **2.2.2. ユーザー体験の向上**
    -   フォームの送信処理中は、「作成」「更新」ボタンを無効化し、ローディングインジケーターを表示する。これにより、ユーザーの二重送信を防ぐ。
    -   編集時に「変更理由」を必須項目とするバリデーションをフロントエンドに追加する。

## 3. 成果物

1.  **ソースコード:**
    -   上記要件を満たし、堅牢性が向上したバックエンドAPIとフロントエンドのコード。
2.  **ドキュメント:**
    -   本SOW (`docs/SOW_Implementation_Phase_6_Robustness.md`)。

## 4. 開発上の絶対的ルール
-   本件の開発は、`docs/GEMINI_RULES.md` に記載されたルールに厳密に従うものとする。
