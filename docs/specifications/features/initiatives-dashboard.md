# 要件定義書: 施策管理ダッシュボード

## 1. 概要

本ドキュメントは、採用、スタッフ定着、業務改善など、事業運営に関わる各種「施策」を一元的に管理、追跡、評価するための「施策管理ダッシュボード」機能の要件を定義する。

## 2. 目的

-   **施策の可視化**: 進行中の全施策を一覧化し、進捗状況を誰もが把握できる状態にする。
-   **PDCAサイクルの促進**: 「課題→原因→アクション→結果」のフレームワークに基づき、施策の記録と評価を構造化し、データに基づいた改善サイクルを促進する。
-   **ナレッジの蓄積**: 施策の変更履歴をバージョンとして保存し、過去の経緯や学びを組織のナレッジ���して蓄積する。

## 3. 機能要件

### 3.1. 主要画面

ダッシュボードは大きく分けて「施策一覧エリア（左パネル）」と「施策詳細エリア（右パネル）」の2つで構成される。

| エリア | コンポーネント | 説明 |
| :--- | :--- | :--- |
| **左パネル** | **フィルター** | カテゴリ、ステータス、優先度で表示する施策を絞り込む。 |
| | **検索ボックス** | 施策タイトルや担当者名でインクリメンタル検索を行う。 |
| | **施策一覧** | フィルター・検索条件に合致した施策をカード形式で表示する。各カードにはタイトル、カテゴリ、ステータス、優先度、担当者、更新日などの要約情報を示す。 |
| **右パネル** | **施策詳細** | 選択された施策の現在の状態（課題、原因、アクション、結果）を明確に表示する。 |
| | **変更履歴** | 施策の過去のバージョン一覧を表示する。 |
| | **バージョン比較** | 任意の2つのバージョンを選択し、変更点をハイライト表示する機能を提供する。 |
| **共通** | **新規作成/編集モーダル** | 新規施策の作成、および既存施策の編集を行うためのフォームをモーダルウィンドウで提供する。 |

### 3.2. データモデル (Firestore)

-   **`initiatives` コレクション**: 施策のヘッダー情報。
    -   `title`: 施策名
    -   `category`: カテゴリ (採用, 定着など)
    -   `status`: ステータス (計画中, 進行中など)
    -   `priority`: 優先度 (高, 中, 低)
    -   `assignee`: 担当者
    -   `dueDate`: 期限日
    -   `currentVersion`: 最新のバージョン番号
    -   `createdAt`, `updatedAt`: 作成日時, 更新日時
-   **`initiative_versions` コレクション**: 施策の具体的な内容をバージョンごとに記録。
    -   `initiativeId`: `initiatives` ドキュメントへの参照ID
    -   `version`: バージョン番号
    -   `issue`: 課題
    -   `cause`: 原因
    -   `action`: アクション
    -   `result`: 結果
    -   `changeReason`: 変更理由
    -   `createdAt`, `createdBy`: バージョン作成日時, 作成者

### 3.3. API仕様

| Method | Endpoint | 説明 |
| :--- | :--- | :--- |
| `GET` | `/api/initiatives` | 全ての施策情報を取得する。 |
| `GET` | `/api/initiatives/[id]` | 指定したIDの施策の完全な情報（変更履歴を含む）を取得する。 |
| `POST` | `/api/initiatives` | 新しい施策を作成する。リクエストボディのデータに基づき、`initiatives` と `initiative_versions` の両方にドキュメントを作成する。 |
| `PUT` | `/api/initiatives/[id]` | 既存の施策を更新する。`initiatives` ドキュメントを更新し、新しい `initiative_versions` ドキュメントを作成する。 |

### 3.4. 主要機能の詳細仕様

#### 3.4.1. バージョン管理 (変更履歴)

-   **目的**: 施策の変更経緯を可視化し、思考プロセスや学びを組織のナレッジとして蓄積する。
-   **トリガー**: ユーザーが既存の施策を「編集」し、「更新」ボタンを押下した時。
-   **仕様**:
    1.  システムは、フォームから送信された新しい内容で**新しいバージョン**のデータ (`initiative_versions` ドキュメント) を作成する。過去のバージョンは変更されずに保持される。
    2.  「変更理由」の入力は必須とし、変更の意図を必ず記録させる。
    3.  施策本体 (`initiatives` ドキュメント) は、最新のバージョン番号やステータスなどのサマリー情報を保持する。
-   **期待される効果**: 「なぜこの施策は今の形になったのか？」という問いにいつでも答えられるようになり、担当者が変わってもスムーズな引き継ぎが可能になる。

#### 3.4.2. バージョン比較

-   **目的**: 2つのバージョン間の差分をハイライト表示することで、施策の変更がもたらした影響（結果）を分析し、効果測定を支援する。
-   **トリガー**: ユーザーが「変更履歴」セクションで、比較したい2つのバージョンの「比較に追加」ボタンを押下した時。
-   **仕様**:
    1.  選択された2つのバージョンのデータ（課題、原因、アクション、結果など）を項目ごとに比較する。
    2.  変更があった項目について、変更前（-）と変更後（+）の内容を並べて表示し、差分を明確にする。
-   **期待される効果**: 「アクションAをアクションBに変更した結果、数値CがDに改善した」といった因果関係の仮説検証が容易になり、データに基づいた意思決定（Data-Driven Decision Making）を促進する。

## 4. 過去の改修履歴 (抜粋)

-   **Phase 5 (2025-07-16)**: UI非反映問題の解決。API、フック、UIコンポーネント間のデータの流れを可視化し、根本原因を特定・修正。
-   **Phase 6 (2025-07-16)**: 機能の堅牢性向上。API側の入力値バリデーション（必須項目、日付形式）と、フロントエンド側の詳細なエラーハンドリングを実装。Firestoreのインデックス不足を解消。
