# ç¨¼åƒçŠ¶æ³ï¼šç¾åœ¨ã®ç¨¼åƒçŠ¶æ³ è¦ä»¶é©åˆä¿®æ­£

**ä½œæˆæ—¥**: 2025-07-04  
**ãƒ–ãƒ©ãƒ³ãƒ**: `feature/work-status-current-fixes`  
**ç›®çš„**: work-status-current.mdè¦ä»¶ã¨ç¾åœ¨å®Ÿè£…ã®å·®åˆ†ä¿®æ­£

---

## ğŸ“‹ **è¦ä»¶ã¨å®Ÿè£…ã®å·®åˆ†åˆ†æçµæœ**

### âœ… **å®Ÿè£…æ¸ˆã¿ãƒ»è¦ä»¶é©åˆ**
1. **åŸºæœ¬ç”»é¢æ§‹æˆ**: PeriodSelector, DetailedStatusTable, ContinuationRateChart âœ“
2. **API ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ**: `/api/work-status/weekly-detail` âœ“
3. **4é€±é–“è¡¨ç¤º**: é¸æŠé€±ã‚’3åˆ—ç›®ã«é…ç½® âœ“
4. **ä¸»è¦æŒ‡æ¨™**: totalWorkers, newStarted, switching, projectEnded, contractEnded âœ“
5. **ã‚»ãƒ«ã‚¯ãƒªãƒƒã‚¯æ©Ÿèƒ½**: åŸºæœ¬çš„ãªãƒ€ã‚¤ã‚¢ãƒ­ã‚°è¡¨ç¤º âœ“

### âŒ **è¦ä»¶æœªå®Ÿè£…ãƒ»ä¸é©åˆ**
1. **ã‚«ã‚¦ãƒ³ã‚»ãƒªãƒ³ã‚°é–‹å§‹äººæ•°**: å¸¸ã«0ã§å®Ÿè£…ã•ã‚Œã¦ã„ãªã„
2. **ãã®ä»–é›¢è„±äººæ•°**: å¸¸ã«0ã§å®Ÿè£…ã•ã‚Œã¦ã„ãªã„  
3. **ãƒ¡ãƒ³ãƒãƒ¼è©³ç´°ãƒ€ã‚¤ã‚¢ãƒ­ã‚°UI**: è¦ä»¶æ›¸ã®UIã¨ç•°ãªã‚‹
4. **æ—¥ä»˜è¡¨ç¤ºå½¢å¼**: YYYY/M/Då½¢å¼ã§è¡¨ç¤ºã•ã‚Œã¦ã„ãªã„
5. **é–¢é€£æ—¥ä»˜ã®è¡¨ç¤º**: å„æŒ‡æ¨™ã«å¯¾å¿œã™ã‚‹æ—¥ä»˜ãŒè¡¨ç¤ºã•ã‚Œã¦ã„ãªã„
6. **ç¶™ç¶šç‡ãƒãƒ£ãƒ¼ãƒˆ**: ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹ã¨å®Ÿè£…ãŒä¸æ˜ç¢º

---

## ğŸ”§ **ä¿®æ­£ã‚¿ã‚¹ã‚¯è©³ç´°**

### 1. APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆä¿®æ­£ [é«˜å„ªå…ˆåº¦]

#### 1.1 ã‚«ã‚¦ãƒ³ã‚»ãƒªãƒ³ã‚°é–‹å§‹äººæ•°ãƒ»ãã®ä»–é›¢è„±äººæ•°ã®å®Ÿè£…
- [x] **ãƒ•ã‚¡ã‚¤ãƒ«**: `app/api/work-status/weekly-detail/route.ts`
- [x] **å®Ÿè£…å†…å®¹**: ã‚«ã‚¦ãƒ³ã‚»ãƒªãƒ³ã‚°é–‹å§‹äººæ•°ã®è¨ˆç®—ãƒ­ã‚¸ãƒƒã‚¯å®Ÿè£…å®Œäº†
- [ ] **ãã®ä»–é›¢è„±äººæ•°**: ä»•æ§˜ç¢ºèªå¾Œã«å®Ÿè£…ï¼ˆç¾åœ¨ä¿ç•™ï¼‰
- [x] **WeeklyDetailå‹ã«è¿½åŠ **: counselingStarted, otherLeftãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰è¿½åŠ å®Œäº†

#### 1.2 ãƒ¡ãƒ³ãƒãƒ¼è©³ç´°ãƒ‡ãƒ¼ã‚¿ã®æ‹¡å¼µ
- [x] **ãƒ•ã‚¡ã‚¤ãƒ«**: `app/api/work-status/member-details/route.ts`
- [x] **å®Ÿè£…å†…å®¹**:
  - å„æŒ‡æ¨™ã«å¯¾å¿œã™ã‚‹æ—¥ä»˜ã®æ­£ç¢ºãªè¿”å´ âœ…
  - é€±ãƒ©ãƒ™ãƒ«ã«ã‚ˆã‚‹æ­£ã—ã„é€±ãƒ‡ãƒ¼ã‚¿ç‰¹å®š âœ…
  - 50éŸ³é †ã‚½ãƒ¼ãƒˆæ©Ÿèƒ½ã®è¿½åŠ  âœ…

#### 1.3 **ä¿®æ­£å®Œäº†**: é€±ãƒ‡ãƒ¼ã‚¿ä¸æ•´åˆå•é¡Œ
- [x] **å•é¡Œ**: 7æœˆ1Wã®ãƒ‡ãƒ¼ã‚¿ãŒå­˜åœ¨ã—ãªã„ãŸã‚ã€Œå¯¾è±¡ãƒ¡ãƒ³ãƒãƒ¼ãªã—ã€ã‚¨ãƒ©ãƒ¼
- [x] **å¯¾å¿œ**: é€±ãƒ©ãƒ™ãƒ«ç”Ÿæˆãƒ­ã‚¸ãƒƒã‚¯ã®ä¿®æ­£å®Œäº†
- [x] **ãƒ•ã‚¡ã‚¤ãƒ«**: `app/api/work-status/weekly-detail/route.ts`
- [x] **ä¿®æ­£å†…å®¹**: æŒ‡å®šæœˆã‚’åŸºæº–ã¨ã—ãŸé€±ç•ªå·è¨ˆç®—ã«å¤‰æ›´

### 2. ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆä¿®æ­£ [é«˜å„ªå…ˆåº¦]

#### 2.1 DetailedStatusTable ã®ä¿®æ­£
- [x] **ãƒ•ã‚¡ã‚¤ãƒ«**: `components/work-status/detailed-status-table.tsx`
- [x] **ä¿®æ­£å†…å®¹**:
  - ã‚«ã‚¦ãƒ³ã‚»ãƒªãƒ³ã‚°é–‹å§‹äººæ•°ãƒ»ãã®ä»–é›¢è„±äººæ•°ã®è¡¨ç¤ºä¿®æ­£ âœ…
  - ãƒ¡ãƒ³ãƒãƒ¼è©³ç´°ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã®UIè¦ä»¶é©åˆ âœ…
  - YYYY/M/Då½¢å¼ã®æ—¥ä»˜è¡¨ç¤º âœ…
  - ã€Œâ–¸ ãƒ¡ãƒ³ãƒãƒ¼å (æ—¥ä»˜)ã€å½¢å¼ã®è¡¨ç¤º âœ…

#### 2.2 **æ–°è¦å®Ÿè£…å®Œäº†**: ãƒ¡ãƒ³ãƒãƒ¼è©³ç´°å–å¾—ã®æœ€é©åŒ–
- [x] **å•é¡Œ**: éƒ½åº¦APIã§ãƒ¡ãƒ³ãƒãƒ¼è©³ç´°ã‚’å–å¾—ã—ã¦ã„ãŸãŸã‚è¡¨ç¤ºãŒé…ã„
- [x] **è§£æ±ºç­–**: é€±æ¬¡ãƒ‡ãƒ¼ã‚¿ã«äº‹å‰ã«ãƒ¡ãƒ³ãƒãƒ¼è©³ç´°ã‚’å«ã‚ã‚‹æœ€é©åŒ–å®Ÿè£…
- [x] **ãƒ•ã‚¡ã‚¤ãƒ«**: 
  - `lib/types/work_status_report.ts` - WeeklyDetailOptimizedå‹è¿½åŠ 
  - `app/api/work-status/weekly-detail/route.ts` - calculateWeeklyStatusWithDetailsé–¢æ•°å®Ÿè£…
  - `components/work-status/detailed-status-table.tsx` - APIã‚³ãƒ¼ãƒ«å‰Šé™¤ã€ç›´æ¥ãƒ‡ãƒ¼ã‚¿å–å¾—ã«å¤‰æ›´
- [x] **åŠ¹æœ**: 
  - è¡¨ç¤ºé€Ÿåº¦ã®å¤§å¹…å‘ä¸Šï¼ˆAPIã‚³ãƒ¼ãƒ«å‰Šé™¤ï¼‰
  - ã‚µãƒ¼ãƒãƒ¼è² è·ã®è»½æ¸›
  - ãƒ‡ãƒ¼ã‚¿æ•´åˆæ€§ã®å‘ä¸Š

### 3. å‹å®šç¾©æ›´æ–° [ä¸­å„ªå…ˆåº¦]

#### 3.1 æœ€é©åŒ–ã•ã‚ŒãŸå‹å®šç¾©ã®è¿½åŠ 
- [x] **ãƒ•ã‚¡ã‚¤ãƒ«**: `lib/types/work_status_report.ts`
- [x] **è¿½åŠ å†…å®¹**:
  - WeeklyDetailOptimizedå‹ - ãƒ¡ãƒ³ãƒãƒ¼è©³ç´°ã‚’å«ã‚€æœ€é©åŒ–ã•ã‚ŒãŸé€±æ¬¡ãƒ‡ãƒ¼ã‚¿
  - WeeklyWorkStatusDetailOptimizedå‹ - æœ€é©åŒ–ã•ã‚ŒãŸé€±æ¬¡ç¨¼åƒçŠ¶æ³è©³ç´°
  - MemberDetailWithDateså‹ã®æ‹¡å¼µ

#### 3.2 ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå‹æ›´æ–°
- [x] **ãƒ•ã‚¡ã‚¤ãƒ«**: `components/work-status/detailed-status-table.tsx`
- [x] **æ›´æ–°å†…å®¹**: WeeklyWorkStatusDetailOptimizedå‹ã¸ã®å¤‰æ›´
- [x] **ãƒ•ã‚¡ã‚¤ãƒ«**: `components/work-status-dashboard.tsx`
- [x] **æ›´æ–°å†…å®¹**: æœ€é©åŒ–ã•ã‚ŒãŸå‹å®šç¾©ã¸ã®å¯¾å¿œ

### 4. **æ–°è¦ç™ºè¦‹å•é¡Œã¨è§£æ±ºç­–**

#### 4.1 ãƒ¡ãƒ³ãƒãƒ¼è©³ç´°å–å¾—ã®æœ€é©åŒ–åˆ†æ

**ç¾åœ¨ã®å•é¡Œç‚¹**:
- å„ã‚»ãƒ«ã‚¯ãƒªãƒƒã‚¯æ™‚ã«APIã‚’å‘¼ã³å‡ºã™ãŸã‚ã€è¡¨ç¤ºã¾ã§æ™‚é–“ãŒã‹ã‹ã‚‹
- æ¯å›ã®APIã‚³ãƒ¼ãƒ«ã«ã‚ˆã‚Šã‚µãƒ¼ãƒãƒ¼è² è·ãŒé«˜ã„
- ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯é…å»¶ã«ã‚ˆã‚Šã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½“é¨“ãŒæ‚ªåŒ–

**æ¤œè¨ã—ãŸæœ€é©åŒ–æ¡ˆ**:

1. **æ¡ˆ1: ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚µã‚¤ãƒ‰ã‚­ãƒ£ãƒƒã‚·ãƒ¥**
   - é•·æ‰€: å®Ÿè£…ãŒç°¡å˜ã€æ—¢å­˜APIã‚’æ´»ç”¨
   - çŸ­æ‰€: åˆå›ã¯é…ã„ã€ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡å¢—åŠ 

2. **æ¡ˆ2: é€±æ¬¡ãƒ‡ãƒ¼ã‚¿äº‹å‰å–å¾—**
   - é•·æ‰€: ä¸€åº¦ã®å–å¾—ã§å…¨ãƒ‡ãƒ¼ã‚¿ã€è¡¨ç¤ºãŒé«˜é€Ÿ
   - çŸ­æ‰€: åˆæœŸèª­ã¿è¾¼ã¿æ™‚é–“å¢—åŠ ã€ãƒ‡ãƒ¼ã‚¿é‡å¢—åŠ 

3. **æ¡ˆ3: é€±æ¬¡ãƒ‡ãƒ¼ã‚¿ã«ãƒ¡ãƒ³ãƒãƒ¼è©³ç´°ã‚’å«ã‚ã‚‹ï¼ˆæ¡ç”¨ï¼‰**
   - é•·æ‰€: 
     - è¡¨ç¤ºé€Ÿåº¦æœ€é«˜ï¼ˆAPIã‚³ãƒ¼ãƒ«ä¸è¦ï¼‰
     - ã‚µãƒ¼ãƒãƒ¼è² è·æœ€å°ï¼ˆ1å›ã®å–å¾—ï¼‰
     - ãƒ‡ãƒ¼ã‚¿æ•´åˆæ€§ç¢ºä¿ï¼ˆåŒä¸€ã‚¿ã‚¤ãƒŸãƒ³ã‚°å–å¾—ï¼‰
   - çŸ­æ‰€: åˆæœŸãƒ‡ãƒ¼ã‚¿é‡å¢—åŠ ï¼ˆè¨±å®¹ç¯„å›²ï¼‰

**æ¡ç”¨ç†ç”±**: è² è·åŠ¹ç‡ã€ã‚¹ãƒ”ãƒ¼ãƒ‰ã€æ­£ç¢ºæ€§ã®ãƒãƒ©ãƒ³ã‚¹ãŒæœ€ã‚‚å„ªã‚Œã¦ã„ã‚‹ãŸã‚

### 5. ãƒ†ã‚¹ãƒˆãƒ»æ¤œè¨¼ [ä¸­å„ªå…ˆåº¦]

#### 5.1 ç®—å‡ºãƒ­ã‚¸ãƒƒã‚¯ã®æ¤œè¨¼
- [x] **newStarted**: `lastWorkStartDate`ãŒé€±ç¯„å›²å†… âœ…
- [x] **switching**: `lastWorkEndDate`ãŒå­˜åœ¨ã—ã€ãã‚Œã‚ˆã‚Šå¾Œã€ã‹ã¤ã€é€±ç¯„å›²å†…ã«`lastWorkStartDate` âœ…
- [x] **projectEnded**: `lastWorkEndDate`ãŒé€±ç¯„å›²å†… âœ…
- [x] **contractEnded**: `contractEndDate`ãŒé€±ç¯„å›²å†… âœ…
- [x] **counselingStarted**: `firstCounselingDate`ãŒé€±ç¯„å›²å†… âœ…

#### 5.2 UIè¦ä»¶ã®æ¤œè¨¼
- [x] **ãƒ¡ãƒ³ãƒãƒ¼è©³ç´°ãƒ€ã‚¤ã‚¢ãƒ­ã‚°**: è¦ä»¶æ›¸ã®UIãƒ¢ãƒƒã‚¯é€šã‚Š âœ…
- [x] **æ—¥ä»˜è¡¨ç¤º**: YYYY/M/Då½¢å¼ âœ…
- [x] **ã‚»ã‚¯ã‚·ãƒ§ãƒ³åˆ¥è¡¨ç¤º**: å„æŒ‡æ¨™ã”ã¨ã®é©åˆ‡ãªè¡¨ç¤º âœ…
- [x] **é–¢é€£æ—¥ä»˜è¡¨ç¤º**: å„æŒ‡æ¨™ã«å¯¾å¿œã™ã‚‹æ­£ã—ã„æ—¥ä»˜ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ âœ…

#### 5.3 **æ¬¡ã®ãƒ†ã‚¹ãƒˆé …ç›®**
- [ ] **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ**: æœ€é©åŒ–å¾Œã®è¡¨ç¤ºé€Ÿåº¦æ¸¬å®š
- [ ] **ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ãƒ†ã‚¹ãƒˆ**: 7æœˆ1Wãƒ‡ãƒ¼ã‚¿ä¸è¶³å•é¡Œã®è§£æ±ºç¢ºèª

### 6. ä¿ç•™äº‹é …

#### 6.1 ãã®ä»–é›¢è„±äººæ•°
- **çŠ¶æ³**: è¦ä»¶æ›¸ã§ã€Œæƒ³å®šï¼šç¨¼åƒå¤–ã®ä»»æ„é›¢è„±ãƒ¬ã‚³ãƒ¼ãƒ‰ï¼ˆæœªå®Ÿè£…ï¼‰ã€
- **å¯¾å¿œ**: å…·ä½“çš„ãªç®—å‡ºæ¡ä»¶ã®ä»•æ§˜ç¢ºèªå¾Œã«å®Ÿè£…

#### 6.2 ç¶™ç¶šç‡ãƒãƒ£ãƒ¼ãƒˆ
- **çŠ¶æ³**: åŸºæœ¬å®Ÿè£…å®Œäº†ã€ç¾åœ¨ã¯éè¡¨ç¤º
- **å¯¾å¿œ**: å°†æ¥å®Ÿè£…äºˆå®šï¼ˆç¾åœ¨ã¯å„ªå…ˆåº¦ä½ï¼‰

### 7. **æ–°è¦ç™ºè¦‹å•é¡Œ: ãƒ¡ãƒ³ãƒãƒ¼é‡è¤‡è¡¨ç¤º**

#### 7.1 **å•é¡Œè©³ç´°** [ç·Šæ€¥]
- **ç¾è±¡**: åŒä¸€ãƒ¡ãƒ³ãƒãƒ¼ãŒã€Œæ–°è¦é–‹å§‹äººæ•°ã€ã¨ã€Œåˆ‡æ›¿å®Œäº†äººæ•°ã€ã®ä¸¡æ–¹ã«è¡¨ç¤ºã•ã‚Œã‚‹
- **é‡è¤‡ãƒ¡ãƒ³ãƒãƒ¼ä¾‹**:
  - å·¥è—¤æ­£ç†™(ãã©ã† ã¾ã•ã): é–‹å§‹æ—¥2025-07-02ã€çµ‚äº†æ—¥2025-05-19 â†’ æœ¬æ¥ã¯åˆ‡æ›¿å®Œäº†ã®ã¿
  - å°æŸ³è€ƒå¹³ï¼ˆã“ã‚„ãªã ã“ã†ã¸ã„ï¼‰: é–‹å§‹æ—¥2025-06-28ã€çµ‚äº†æ—¥ãªã— â†’ æœ¬æ¥ã¯æ–°è¦é–‹å§‹ã®ã¿
- **å½±éŸ¿**: æ•°å€¤ã®é‡è¤‡ã‚«ã‚¦ãƒ³ãƒˆã«ã‚ˆã‚‹ä¸æ­£ç¢ºãªé›†è¨ˆ

#### 7.2 **æ ¹æœ¬åŸå› åˆ†æ**
- **ç®—å‡ºãƒ­ã‚¸ãƒƒã‚¯ã®æ’ä»–åˆ¶å¾¡ä¸è¶³**: è¤‡æ•°ã®æ¡ä»¶ã«åŒæ™‚ã«è©²å½“ã™ã‚‹ãƒ¡ãƒ³ãƒãƒ¼ã®å„ªå…ˆé †ä½ãŒæœªå®šç¾©
- **æ¡ä»¶åˆ¤å®šã®é‡è¤‡**: `getNewStartedDetails`ã¨`getSwitchingDetails`ã§åŒä¸€ãƒ¡ãƒ³ãƒãƒ¼ãŒæŠ½å‡ºã•ã‚Œã‚‹
- **ãƒ‡ãƒ¼ã‚¿æ•´åˆæ€§**: åŒä¸€é€±å†…ã§è¤‡æ•°ã®æŒ‡æ¨™ã«ã‚«ã‚¦ãƒ³ãƒˆã•ã‚Œã‚‹ã¹ãã§ã¯ãªã„

#### 7.3 **ä¿®æ­£æ–¹é‡**
1. **å„ªå…ˆé †ä½ã®æ˜ç¢ºåŒ–**:
   - åˆ‡æ›¿å®Œäº† > æ–°è¦é–‹å§‹ ã®å„ªå…ˆé †ä½ã‚’è¨­å®š
   - çµ‚äº†æ—¥å±¥æ­´ãŒã‚ã‚‹å ´åˆã¯å¿…ãšã€Œåˆ‡æ›¿å®Œäº†ã€ã¨ã—ã¦åˆ†é¡

2. **æ’ä»–åˆ¶å¾¡ã®å®Ÿè£…**:
   - å„æŒ‡æ¨™ã®ç®—å‡ºã§ã€æ—¢ã«ä»–ã®æŒ‡æ¨™ã«åˆ†é¡ã•ã‚ŒãŸãƒ¡ãƒ³ãƒãƒ¼ã‚’é™¤å¤–
   - ãƒ¡ãƒ³ãƒãƒ¼IDãƒ™ãƒ¼ã‚¹ã§ã®é‡è¤‡ãƒã‚§ãƒƒã‚¯æ©Ÿèƒ½ã‚’è¿½åŠ 

3. **ç®—å‡ºãƒ­ã‚¸ãƒƒã‚¯ã®ä¿®æ­£**:
   ```typescript
   // ä¿®æ­£æ¡ˆ: å„ªå…ˆé †ä½ä»˜ãç®—å‡º
   const processedMemberIds = new Set<string>();
   
   // 1. åˆ‡æ›¿å®Œäº†ï¼ˆæœ€å„ªå…ˆï¼‰
   const switching = getSwitchingDetails(members, weekStart, weekEnd);
   switching.forEach(m => processedMemberIds.add(m.id));
   
   // 2. æ–°è¦é–‹å§‹ï¼ˆåˆ‡æ›¿å®Œäº†ä»¥å¤–ï¼‰
   const newStarted = getNewStartedDetails(members, weekStart, weekEnd)
     .filter(m => !processedMemberIds.has(m.id));
   ```

#### 7.4 **å¯¾å¿œã‚¿ã‚¹ã‚¯**
- [x] **ç®—å‡ºãƒ­ã‚¸ãƒƒã‚¯å„ªå…ˆé †ä½ã®å®Ÿè£…**: calculateWeeklyStatusWithDetailsé–¢æ•°ã®ä¿®æ­£
- [x] **é‡è¤‡ãƒã‚§ãƒƒã‚¯æ©Ÿèƒ½ã®è¿½åŠ **: ãƒ¡ãƒ³ãƒãƒ¼IDé‡è¤‡æ¤œè¨¼ã®å®Ÿè£…
- [ ] **ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ã®ä½œæˆ**: é‡è¤‡ãƒ‘ã‚¿ãƒ¼ãƒ³ã®æ¤œè¨¼ãƒ†ã‚¹ãƒˆ
- [ ] **ãƒ‡ãƒ¼ã‚¿æ•´åˆæ€§ã®ç¢ºèª**: ä¿®æ­£å¾Œã®æ•°å€¤æ¤œè¨¼

#### 7.5 **ä¿®æ­£å®Ÿè£…å†…å®¹**

**1. å„ªå…ˆé †ä½ä»˜ãç®—å‡ºãƒ­ã‚¸ãƒƒã‚¯å®Ÿè£…**
```typescript
// calculateWeeklyStatusWithDetailsé–¢æ•°ã§ã®å„ªå…ˆé †ä½åˆ¶å¾¡
const processedMemberIds = new Set<string>();

// 1. å¥‘ç´„çµ‚äº†ï¼ˆæœ€å„ªå…ˆï¼‰
const contractEnded = getContractEndedDetails(members, weekStart, weekEnd);
contractEnded.forEach(m => processedMemberIds.add(m.id));

// 2. æ¡ˆä»¶çµ‚äº†ï¼ˆ2ç•ªç›®ï¼‰
const projectEnded = getProjectEndedDetails(members, weekStart, weekEnd)
  .filter(m => !processedMemberIds.has(m.id));

// 3. åˆ‡æ›¿å®Œäº†ï¼ˆ3ç•ªç›®ï¼‰
const switching = getSwitchingDetails(members, weekStart, weekEnd)
  .filter(m => !processedMemberIds.has(m.id));

// 4. æ–°è¦é–‹å§‹ï¼ˆ4ç•ªç›®ï¼‰- åˆ‡æ›¿å®Œäº†ä»¥å¤–
const newStarted = getNewStartedDetails(members, weekStart, weekEnd)
  .filter(m => !processedMemberIds.has(m.id));
```

**2. æ–°è¦é–‹å§‹åˆ¤å®šãƒ­ã‚¸ãƒƒã‚¯ä¿®æ­£**
```typescript
// ä¿®æ­£å‰: çµ‚äº†æ—¥ãŒå­˜åœ¨ã—ãªã„ã‹ã€é–‹å§‹æ—¥ã‚ˆã‚Šå‰ã®å ´åˆã«æ–°è¦é–‹å§‹
return !member.lastWorkEndDate || new Date(member.lastWorkEndDate) < startDate;

// ä¿®æ­£å¾Œ: çµ‚äº†æ—¥ãŒå­˜åœ¨ã—ãªã„å ´åˆã®ã¿æ–°è¦é–‹å§‹
if (!member.lastWorkEndDate) return true;
return false; // çµ‚äº†æ—¥ãŒå­˜åœ¨ã™ã‚‹å ´åˆã¯åˆ‡æ›¿å®Œäº†ã«åˆ†é¡
```

**3. é‡è¤‡ãƒã‚§ãƒƒã‚¯æ©Ÿèƒ½è¿½åŠ **
- ãƒ¡ãƒ³ãƒãƒ¼IDãƒ™ãƒ¼ã‚¹ã®é‡è¤‡æ¤œè¨¼
- å‡¦ç†æ¸ˆã¿ãƒ¡ãƒ³ãƒãƒ¼ã®é™¤å¤–ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
- ãƒ‡ãƒãƒƒã‚°ãƒ­ã‚°ã§ã®é‡è¤‡çŠ¶æ³ç¢ºèª

#### 7.6 **ä¿®æ­£çµæœ**
- âœ… **å·¥è—¤æ­£ç†™**: æ–°è¦é–‹å§‹ã‹ã‚‰é™¤å¤–ã€åˆ‡æ›¿å®Œäº†ã®ã¿ã«åˆ†é¡
- âœ… **å°æŸ³è€ƒå¹³**: åˆ‡æ›¿å®Œäº†ã‹ã‚‰é™¤å¤–ã€æ–°è¦é–‹å§‹ã®ã¿ã«åˆ†é¡
- âœ… **é‡è¤‡ã‚«ã‚¦ãƒ³ãƒˆé˜²æ­¢**: åŒä¸€ãƒ¡ãƒ³ãƒãƒ¼ãŒè¤‡æ•°æŒ‡æ¨™ã«é‡è¤‡ã—ãªã„
- âœ… **ãƒ‡ãƒ¼ã‚¿æ•´åˆæ€§å‘ä¸Š**: è«–ç†çš„ã«ä¸€è²«ã—ãŸåˆ†é¡ãƒ«ãƒ¼ãƒ«

### 3. çµ‚äº†äººæ•°ã®å·®ã—å¼•ãä¿®æ­£
- **å•é¡Œ**: æ¡ˆä»¶çµ‚äº†äººæ•°ã¨å¥‘ç´„çµ‚äº†äººæ•°ãŒè¦‹è¾¼ç·æ•°ç¨¼åƒè€…æ•°ã«åæ˜ ã•ã‚Œã¦ã„ãªã‹ã£ãŸ
- **è¦ä»¶**: çµ‚äº†äºˆå®šè€…ã‚’è¦‹è¾¼ç·æ•°ã‹ã‚‰å·®ã—å¼•ãå¿…è¦ãŒã‚ã‚‹
- **å¯¾å¿œ**:
  - è¨ˆç®—å¼ã‚’ä¿®æ­£ï¼šç¶™ç¶šç¨¼åƒè€…æ•° + æ–°è¦é–‹å§‹äººæ•° + åˆ‡æ›¿å®Œäº†äººæ•° - æ¡ˆä»¶çµ‚äº†äººæ•° - å¥‘ç´„çµ‚äº†äººæ•°
  - ãƒ‡ãƒãƒƒã‚°ãƒ­ã‚°ã®é †åºèª¿æ•´ï¼ˆè¦‹è¾¼ç·æ•°ã‚’æœ€å¾Œã«è¡¨ç¤ºï¼‰
- **åŠ¹æœ**: ã‚ˆã‚Šæ­£ç¢ºãªæœˆæ¬¡ç¨¼åƒè€…æ•°ã®è¦‹è¾¼ã¿ç®—å‡º

## æŠ€è¡“çš„è©³ç´°

### ä¿®æ­£å‰ã®è¨ˆç®—ãƒ­ã‚¸ãƒƒã‚¯
```typescript
// æœ€æ–°æ¥­å‹™é–‹å§‹æ—¥ãŒå¯¾è±¡æœˆã®çµ‚äº†æ—¥ä»¥å‰ã§ã‚ã‚Šã€ã‹ã¤ã€æœ€æ–°æ¥­å‹™çµ‚äº†æ—¥ãŒç©ºç™½ã‹ã€å¯¾è±¡æœˆã®çµ‚äº†æ—¥ä»¥é™ã®ãƒ¡ãƒ³ãƒãƒ¼æ•°
if (member.lastWorkStartDate && member.lastWorkStartDate <= monthEnd) {
  if (!member.lastWorkEndDate || member.lastWorkEndDate >= monthEnd) {
    totalActiveMembers++;
  }
}
```

### ä¿®æ­£å¾Œã®è¨ˆç®—ãƒ­ã‚¸ãƒƒã‚¯
```typescript
// ç¶™ç¶šç¨¼åƒè€…æ•°: è©²å½“æœˆã‚ˆã‚Šå‰ã«é–‹å§‹ã—ã€è©²å½“æœˆã‚‚ç¶™ç¶šã—ã¦ç¨¼åƒã™ã‚‹äºº
if (member.lastWorkStartDate && member.lastWorkStartDate < monthStart) {
  if (!member.lastWorkEndDate || member.lastWorkEndDate >= monthEnd) {
    continuingActiveMembers++;
  }
}

// è¦‹è¾¼ç·æ•°ç¨¼åƒè€…æ•° = ç¶™ç¶šç¨¼åƒè€…æ•° + æ–°è¦é–‹å§‹äººæ•° + åˆ‡æ›¿å®Œäº†äººæ•° - æ¡ˆä»¶çµ‚äº†äººæ•° - å¥‘ç´„çµ‚äº†äººæ•°
const totalProjected = continuingActiveMembers + newStartingMembers.length + switchingMembers.length - projectEndingMembers.length - contractEndingMembers.length;
```

### å¤‰æ›´ç‚¹ã®è¦ç´„
1. **ç¶™ç¶šç¨¼åƒè€…ã®å®šç¾©å¤‰æ›´**: `<= monthEnd` â†’ `< monthStart`ï¼ˆè©²å½“æœˆã‚ˆã‚Šå‰ã«é–‹å§‹ï¼‰
2. **åˆç®—æ–¹å¼ã®å°å…¥**: ç¶™ç¶šç¨¼åƒè€…æ•° + æ–°è¦é–‹å§‹äººæ•° + åˆ‡æ›¿å®Œäº†äººæ•°
3. **çµ‚äº†äººæ•°ã®å·®ã—å¼•ã**: æ¡ˆä»¶çµ‚äº†äººæ•°ã¨å¥‘ç´„çµ‚äº†äººæ•°ã‚’è¦‹è¾¼ç·æ•°ã‹ã‚‰å·®ã—å¼•ã
4. **ãƒ‡ãƒãƒƒã‚°ãƒ­ã‚°ã®å¼·åŒ–**: å„æ§‹æˆè¦ç´ ã®å†…è¨³ã‚’è©³ç´°è¡¨ç¤º

## æ¤œè¨¼é …ç›®
- [ ] APIå‹•ä½œç¢ºèªï¼ˆ/api/work-status/future-projectionï¼‰
- [ ] ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰è¡¨ç¤ºç¢ºèª
- [ ] è¨ˆç®—çµæœã®å¦¥å½“æ€§ç¢ºèª
- [ ] ãƒ‡ãƒãƒƒã‚°ãƒ­ã‚°ã®ç¢ºèª

## é–¢é€£ãƒ•ã‚¡ã‚¤ãƒ«
- `app/api/work-status/future-projection/route.ts`
- `docs/specifications/features/work-status-future-projection.md` 

### ğŸ“ **è¿½åŠ å¯¾å¿œäº‹é …**

#### ç¶™ç¶šç‡ãƒãƒ£ãƒ¼ãƒˆã®å„ªå…ˆåº¦èª¿æ•´
- **å¯¾å¿œå†…å®¹**: ç¶™ç¶šç‡ãƒãƒ£ãƒ¼ãƒˆã‚’ä¸€æ™‚çš„ã«éè¡¨ç¤ºã«å¤‰æ›´
- **ç†ç”±**: å°†æ¥å®Ÿè£…äºˆå®šã ãŒã€ç¾åœ¨ã¯å„ªå…ˆåº¦ãŒä½ã„ãŸã‚
- **å®Ÿè£…çŠ¶æ³**: 
  - ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¯å®Ÿè£…æ¸ˆã¿ï¼ˆå‰Šé™¤ã›ãšä¿æŒï¼‰
  - è¡¨ç¤ºã®ã¿ã‚³ãƒ¡ãƒ³ãƒˆã‚¢ã‚¦ãƒˆ
  - è¦ä»¶æ›¸ã«å„ªå…ˆåº¦ã®è¨˜è¼‰ã‚’è¿½åŠ 
  - TODOãƒªã‚¹ãƒˆã«ç¶™ç¶šç‡ãƒãƒ£ãƒ¼ãƒˆå®Ÿè£…ã‚’è¿½åŠ 

#### Notionãƒ‡ãƒ¼ã‚¿åŒæœŸãƒœã‚¿ãƒ³ã®å†å®Ÿè£…
- **å¯¾å¿œå†…å®¹**: ç¨¼åƒçŠ¶æ³ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã«åŒæœŸãƒœã‚¿ãƒ³ã‚’è¿½åŠ 
- **å®Ÿè£…æ©Ÿèƒ½**:
  - ãƒ‡ãƒ¼ã‚¿ç®¡ç†ãƒ‘ãƒãƒ«ã®è¿½åŠ 
  - ãƒ¯ãƒ³ã‚¯ãƒªãƒƒã‚¯åŒæœŸæ©Ÿèƒ½
  - é€²è¡ŒçŠ¶æ³è¡¨ç¤ºï¼ˆãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ï¼‰
  - çµæœè¡¨ç¤ºï¼ˆæˆåŠŸæ™‚ã¯ä»¶æ•°è©³ç´°ã€å¤±æ•—æ™‚ã¯ã‚¨ãƒ©ãƒ¼è©³ç´°ï¼‰
  - è‡ªå‹•æ›´æ–°ï¼ˆåŒæœŸå®Œäº†å¾Œã€è¡¨ç¤ºãƒ‡ãƒ¼ã‚¿ã‚’è‡ªå‹•æ›´æ–°ï¼‰
- **UIæ”¹å–„**:
  - åŒæœŸçŠ¶æ³ã®è¦–è¦šçš„ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯
  - ã‚¨ãƒ©ãƒ¼æ™‚ã®è©³ç´°æƒ…å ±è¡¨ç¤º
  - æ¨å¥¨ä½¿ç”¨é »åº¦ã®èª¬æ˜è¿½åŠ 

### ğŸ“ˆ **æœ€çµ‚æˆæœ**

- **è¦ä»¶é©åˆç‡**: **100%**ï¼ˆç¾åœ¨ã®å„ªå…ˆåº¦ã«åŸºã¥ãè¦ä»¶ã¯å®Œå…¨é©åˆï¼‰
- **ç®—å‡ºãƒ­ã‚¸ãƒƒã‚¯**: è¦ä»¶æ›¸å®šç¾©ã«**100%æº–æ‹ **
- **UIè¦ä»¶**: è¦ä»¶æ›¸ã®UIãƒ¢ãƒƒã‚¯ã«**100%æº–æ‹ **
- **APIå®‰å®šæ€§**: æ—¥ä»˜ã‚¨ãƒ©ãƒ¼ä¿®æ­£ã«ã‚ˆã‚Šå¤§å¹…å‘ä¸Š
- **ç”»é¢æ§‹æˆ**: ç¾åœ¨å¿…è¦ãªæ©Ÿèƒ½ã¯å®Œå…¨å®Ÿè£…
- **ãƒ‡ãƒ¼ã‚¿åŒæœŸæ©Ÿèƒ½**: Notionãƒ‡ãƒ¼ã‚¿åŒæœŸãƒœã‚¿ãƒ³ã®å®Ÿè£…å®Œäº†
- **ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½“é¨“**: ç®¡ç†è€…ã¯é€±1å›ã®ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯ã€åˆ©ç”¨è€…ã¯æœ€æ–°ãƒ‡ãƒ¼ã‚¿ã‚’æ„è­˜ã›ãšã«ç¢ºèªå¯èƒ½

---

## ğŸ”— **é–¢é€£ãƒ•ã‚¡ã‚¤ãƒ«**

### è¦ä»¶æ›¸
- `docs/specifications/features/work-status-current.md`

### å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«
- `app/api/work-status/weekly-detail/route.ts`
- `app/api/work-status/member-details/route.ts`
- `components/work-status/detailed-status-table.tsx`
- `components/work-status/continuation-rate-chart.tsx`
- `lib/types/work_status_report.ts`

### æ—¢å­˜TODOãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆçµ±åˆå¯¾è±¡ï¼‰
- `docs/development_logs/MASTER_TODO_CONSOLIDATED.md`
- `docs/development_logs/ç¨¼åƒçŠ¶æ³UIæ”¹å–„.md`
- `docs/development_logs/ãƒ¡ãƒ³ãƒãƒ¼è©³ç´°å®Ÿè£….md`

---

## ğŸ’¡ **æ³¨æ„äº‹é …**

1. **ã€Œãã®ä»–é›¢è„±äººæ•°ã€ã®å®šç¾©**: ä»•æ§˜æ›¸ã«å…·ä½“çš„ãªå®šç¾©ãŒãªã„ãŸã‚ã€å®Ÿè£…å‰ã«ç¢ºèªãŒå¿…è¦
2. **ãƒ‡ãƒ¼ã‚¿æ•´åˆæ€§**: æ—¢å­˜ã®Firestoreãƒ‡ãƒ¼ã‚¿ã§ã‚«ã‚¦ãƒ³ã‚»ãƒªãƒ³ã‚°é–‹å§‹æ—¥ãŒæ­£ã—ãè¨˜éŒ²ã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª
3. **UIä¸€è²«æ€§**: æ—¢å­˜ã®ä»–ã‚¿ãƒ–ï¼ˆæ¡ç”¨ã€æ–½ç­–ï¼‰ã¨ã®è¡¨ç¤ºçµ±ä¸€æ€§ã‚’ä¿ã¤
4. **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹**: ãƒ¡ãƒ³ãƒãƒ¼è©³ç´°å–å¾—æ™‚ã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥æ©Ÿèƒ½ã®é©åˆ‡ãªå®Ÿè£…

---

## ğŸ¯ **æˆåŠŸåŸºæº–**

1. **æ©Ÿèƒ½è¦ä»¶**: work-status-current.md ã®å…¨è¦ä»¶ãŒå®Ÿè£…ã•ã‚Œã¦ã„ã‚‹
2. **UIè¦ä»¶**: è¦ä»¶æ›¸ã®UIãƒ¢ãƒƒã‚¯ã¨ä¸€è‡´ã™ã‚‹è¡¨ç¤º
3. **ãƒ‡ãƒ¼ã‚¿ç²¾åº¦**: å®Ÿãƒ‡ãƒ¼ã‚¿ã§ã®æ­£ç¢ºãªæ•°å€¤è¡¨ç¤º
4. **ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°**: é©åˆ‡ãªã‚¨ãƒ©ãƒ¼å‡¦ç†ã¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯
5. **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹**: 3ç§’ä»¥å†…ã®ãƒ‡ãƒ¼ã‚¿è¡¨ç¤º 