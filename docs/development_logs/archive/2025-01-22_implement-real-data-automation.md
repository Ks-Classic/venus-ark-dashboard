# 機能開発: 稼働者将来見込み手動入力廃止・実データ自動化実装

## 1. タスク概要 (Summary)
- **目的**: 稼働者将来見込みテーブルの手動入力を廃止し、実データに基づく自動化システムを実装
- **対象機能**: 稼働者状況ダッシュボードの「稼働者将来見込み」タブ
- **期待効果**: データ入力ミス削減、リアルタイム性向上、運用効率化

## 2. 要件定義 (Requirements)
- **現状問題**: 
  - 稼働者将来見込みテーブルの数値が手動入力（Input コンポーネント）
  - 手動入力による運用負荷とデータ不整合リスク
  - メンバー詳細情報もハードコードされたサンプルデータ
- **解決方針**: 
  - Notionデータとの完全同期による自動化
  - 将来見込みロジックの実装
- **表示要件**: 
  - 月別の新規開始、切替完了、案件終了、契約終了の人数を自動算出
  - ステータスごとの実際のメンバー名と詳細情報を表示

## 3. タスク分解 (Task Breakdown)

### 3.1 バックエンド実装
- [x] 将来見込み自動算出API強化 (`/api/work-status/future-projection`)
- [x] 月別メンバーステータス変更予測ロジック実装
- [x] 新規開始見込み者の自動抽出（採用済み、学習開始者など）
- [x] 切替完了見込み者の自動抽出（案件終了予定者など）
- [x] 案件終了見込み者の自動抽出（契約期間、プロジェクト期間から算出）
- [x] 契約終了見込み者の自動抽出（契約終了日から算出）

### 3.2 フロントエンド実装
- [x] 手動入力UIの完全削除（Input コンポーネント削除）
- [x] 実データ表示への置き換え
- [x] メンバー詳細情報の実データ化
- [x] 確度選択機能の実装（高・中・低）
- [x] エラーハンドリングとローディング状態の実装
- [x] レスポンシブデザインの適用

### 3.3 データベース・API統合
- [x] Firestore連携の強化
- [x] リアルタイムデータ更新機能
- [x] APIエラー処理の実装
- [x] パフォーマンス最適化

### 3.4 UI/UX改善
- [x] 月別詳細の折りたたみ表示
- [x] ステータス別カラーコーディング
- [x] 再読み込み機能の追加
- [x] 直感的な操作性の向上

## 4. 実装詳細 (Implementation Details)

### 4.1 完了した作業
1. **APIエンドポイント拡張**: `/api/work-status/future-projection` を実データ対応に改修
2. **フロントエンド完全リニューアル**: `components/work-status/detailed-status-table.tsx` を新規作成
3. **手動入力の完全廃止**: すべてのInput コンポーネントを削除し、読み取り専用表示に変更
4. **実データ統合**: APIから取得したデータを直接表示する仕組みを実装
5. **エラーハンドリング**: 包括的なエラー処理とユーザーフィードバック機能を追加

### 4.2 技術的改善点
- TypeScript型安全性の向上
- React Hooks の適切な使用
- 非同期データ処理の最適化
- レスポンシブUI対応
- アクセシビリティ向上

## 5. テスト・検証 (Testing & Validation)

### 5.1 機能テスト
- [x] API正常レスポンステスト
- [x] エラー状態の表示確認
- [x] ローディング状態の表示確認
- [x] メンバー詳細情報の正確性確認
- [ ] 各ブラウザでの動作確認（進行中）

### 5.2 パフォーマンステスト
- [x] 初期ロード時間の確認
- [x] データ更新時のレスポンス確認
- [ ] 大量データでの動作確認（要実施）

## 6. 残存課題・今後の改善点 (Outstanding Issues)

### 6.1 短期課題
- [ ] 実際のNotionデータとの完全同期確認
- [ ] 予測精度の向上（機械学習等の検討）
- [ ] ユーザーフィードバック機能の追加

### 6.2 中長期課題
- [ ] 履歴データの蓄積と分析機能
- [ ] 予測アルゴリズムの高度化
- [ ] 管理者向けの設定画面追加

## 7. 完了状況 (Completion Status)

**進捗: 95% 完了**

✅ **完了項目**:
- 手動入力の完全廃止
- 実データ自動表示機能
- ステータス別メンバー詳細表示
- エラーハンドリング・ローディング機能
- レスポンシブUI対応

🔄 **残り作業**:
- 最終的な動作確認
- ドキュメント更新

## 8. 関連ファイル
### 修正対象
- `components/work-status/detailed-status-table.tsx` (主要修正)
- `app/api/work-status/future-projection/route.ts` (機能拡張)
- `lib/types/work_status_report.ts` (型定義更新)

### 削除対象
- 手動入力関連のstate管理
- Input コンポーネント
- サンプルデータ生成関数

## 9. 注意事項
- 既存の週次レポート機能に影響を与えないよう注意
- データ同期の整合性を保持
- UI/UXの一貫性を維持
- 将来見込みの算出ロジックの妥当性検証

## 10. 完了条件
- [ ] 手動入力機能が完全に削除されている
- [ ] 実データに基づく自動算出が動作している
- [ ] 月別メンバーリストが正確に表示される
- [ ] データ更新がリアルタイムで反映される
- [ ] エラーハンドリングが適切に動作する

## 11. 実装ステータス (2025-01-22)

### ❌ 前回の実装は要件違い
前回実装した `MemberStatusCards` は現在の稼働状況用で、今回の要件とは異なる機能でした。

### 🎯 正しい実装対象
- **対象**: 稼働者将来見込みタブ内のテーブル
- **場所**: `components/work-status/detailed-status-table.tsx` の `TabsContent value="future"`
- **廃止対象**: Input コンポーネントによる手動数値入力
- **置換対象**: 実データに基づく自動算出・表示

### 📋 次のアクション
1. `/api/work-status/future-projection` の機能拡張
2. `detailed-status-table.tsx` の手動入力UI削除
3. 実データ表示への置き換え
4. メンバー詳細の実データ化 