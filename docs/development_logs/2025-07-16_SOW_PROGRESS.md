# SOW (作業計画書): ダッシュボード機能の包括的修正 - 進捗管理

**最終更新日:** 2025年7月16日

## 概要

このドキュメントは、採用ダッシュボードおよび稼働状況ダッシュボードの包括的修正に関する作業計画と進捗を記録します。



## 背景
現在、プロジェクトは2つの大きな問題を抱えています。

1.  **稼働状況ダッシュボードのビルドエラー:** `notion.ts` におけるモジュール解決の失敗により、関連機能が完全に停止している。これは最優先で解決すべきブロッカーです。
2.  **採用ダッシュボードの複数不具合:** Firestoreのインデックス不足を解消した後も、データが「0」で表示される、UIが要件と異なる、フィルタが機能しないなど、複数の問題が残存している。

## 目的

1.  ビルドエラーを解消し、アプリケーションを正常に動作する状態に戻す。
2.  採用ダッシュボードのデータフロー（同期→集計→表示）を全面的に見直し、要件通りに正しく機能するよう修正する。
3.  指摘されたUIの不具合をすべて修正する。

---

## 運用ルール
各作業やタスクについて、都度作業内容とステータスを記し、あとからでも進捗と対応内容が明確にわかるようにする

## 作業計画

### フェーズ1: ビルドエラーの即時解決 (所要時間: 3分)

**目的:** ブロッカーを排除し、開発環境を正常化します。

*   **タスク1.1: 原因特定**
    *   **内容:** `notion.ts` の `Module not found` エラーは、`mapping-loader` のインポートパスが誤っていることが原因です。
    *   **ステータス:** <font color="green">完了</font>
    *   **詳細:** `lib/integrations/notion.ts` 内の `import { loadNotionMapping } from '@/lib/mapping-loader';` という記述がエイリアスパスと実際のファイル構造の不一致を引き起こしていたことを確認。

*   **タスク1.2: パス修正**
    *   **内容:** `glob` を使用して `mapping-loader.ts` の正しい位置を特定し、`notion.ts` のインポート文を正しいパスに修正します。
    *   **ステータス:** <font color="green">完了</font>
    *   **詳細:** `lib/integrations/notion.ts` のインポート文を `@/lib/mapping-loader` から `../mapping-loader` に修正しました。

---

### フェーズ2: 採用ダッシュボードのデータフロー修正 (所要時間: 8分)

**目的:** データの「0」問題は、データソース、同期スクリプト、APIのいずれかに根本原因があります。これを上流から順に解決します。

*   **タスク2.1: データ同期ロジックの抜本的見直し**
    *   **仮説:** 「書類提出数」などが0になる最大の原因は、`scripts/sync-recruitment-data.ts` がスプレッドシートからデータを読み取り、Firestore用のデータへ変換・集計する際のロジックに誤りがあることです。
    *   **アクション:** `sync-recruitment-data.ts` を読み込み、特に数値に変換する部分や、各メトリクスを計算するロジックを仕様書と照らし合わせて検証し、修正します。
    *   **ステータス:** <font color="orange">進行中</font>

*   **タスク2.1.2: データ変換ロジックの修正 (lib/data-processing/validation.ts)**
    *   **内容:**
        1.  書類提出日のフォールバック処理: `formSubmissionTimestamp` が取得できない場合でも、他の日付フィールド（例: 応募日）を代替として利用するロジックを追加し、書類提出数が計上されるようにします。
        2.  日付フィールドのパース強化: `parseDate` 関数が、より多様な日付形式（例: `MM/DD`）に対応できるよう拡張します。
        3.  列名の柔軟な解釈: `row['面談予定日時'] || row['面接日']` のように、複数の可能性のある列名をフォールバックとして参照し、データの取りこぼしを防ぎます。
        4.  デバッグログの追加: どの行のどのデータが `null` または `undefined` になっているか追跡しやすくするため、詳細なログ出力コードを追加します。
    *   **ステータス:** <font color="green">完了</font>
    *   **詳細:** `lib/data-processing/validation.ts` を新規作成し、堅牢なデータ検証・変換ロジックを実装しました。

*   **タスク2.2: APIの応答データ検証**
    *   **仮説:** 同期ロジックを修正しても、API (`app/api/recruitment/weekly-reports/route.ts`) がデータを正しく集計・返却できていない可能性があります。
    *   **アクション:** APIの集計ロジックを再確認し、特に `jobCategory` でのフィルタリング部分と、データが存在しない週のハンドリングを堅牢化します。
    *   **ステータス:** <font color="gray">未着手</font>

*   **タスク2.3: 同期ボタンの有効化**
    *   **仮説:** 同期ボタンが押せないのは、データ取得処理の `loading` 状態が解除されていないためです。
    *   **アクション:** `hooks/use-weekly-reports.ts` を見直し、エラー発生時やデータ取得完了時に必ず `loading` 状態が `false` になるよう修正します。
    *   **ステータス:** <font color="gray">未着手</font>

---

### フェーズ3: UI要件の適合 (所要時間: 4分)

**目的:** データフローが正常化した後、フロントエンドの表示を要件に合わせます。

*   **タスク3.1: 媒体フィルタの実装**
    *   **アクション:** `components/recruitment-dashboard.tsx` を修正し、仕様書に記載されている「Indeed」「Engage」などの媒体フィルタを完全な形で実装します。
    *   **ステータス:** <font color="gray">未着手</font>

*   **タスク3.2: テーブルレイアウトの修正**
    *   **アクション:** UIコンポーネントのスタイルを調整し、要件通りのテーブル表示になるよう修正します。
    *   **ステータス:** <font color="gray">未着手</font>

---

## 成果物

*   `docs/development_logs/2025-07-16_SOW_PROGRESS.md` (このファイル)
*   修正済みの `lib/integrations/notion.ts`
*   新規作成/修正済みの `lib/data-processing/validation.ts`
*   修正済みの `scripts/sync-recruitment-data.ts`
*   修正済みの `app/api/recruitment/weekly-reports/route.ts`
*   修正済みの `hooks/use-weekly-reports.ts`
*   修正済みの `components/recruitment-dashboard.tsx`