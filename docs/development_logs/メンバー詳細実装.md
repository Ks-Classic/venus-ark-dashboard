# 機能開発: 主要項目詳細にメンバー名表示機能追加

## 1. 要件概要 (Summary)
- **現象**: 稼働者状況と将来見込みの各数字に対応する具体的なメンバー名が表示されていない
- **要望**: 添付画像のように「主要項目詳細」セクションで各数字（新規開始人数、切替完了人数等）に対応する実際のメンバー名を表示したい
- **影響範囲**: 稼働者状況タブと将来見込みタブの両方

## 2. 正しい要件理解 (Requirements)

### 2.1 稼働者状況（現在タブ）
- 「主要項目詳細」セクションで、各週の数字に対応する**具体的なメンバー名**を表示
- 例：`5月1W 総開始人数` → `新規開始：岩田麗香` のように実際のメンバー名を表示
- 各週の各項目（新規開始、切替完了、案件終了、契約終了等）ごとにメンバーリスト表示

### 2.2 稼働者将来見込み（将来タブ）
- 「主要項目詳細」セクションで、将来の各数字に対応する**予定メンバー名**を表示  
- 例：`4月総開始人数の対象者の名前は下記に記載。（新規開始）` → 実際の予定メンバー名を表示
- 月別・項目別にメンバーリスト表示

### 2.3 将来見込み実データ問題
- 現在、将来見込みが全て0になっているが、実際のデータが反映されていない

## 3. 現在の実装調査結果 (Current Implementation Analysis)

### 3.1 現在の構造
- `DetailedStatusTable` コンポーネントに2つのタブ
  - `current`: 稼働者状況詳細テーブル + 用語定義
  - `future`: 将来見込みテーブル + `FutureItemDetails`コンポーネント
- 将来見込みには既に「主要項目詳細」が実装済み（`FutureItemDetails`）
- **稼働者状況には「主要項目詳細」が未実装**

### 3.2 API状況
- `member-details` API: 現在の稼働状況のメンバー詳細データを提供（実装済み）
- `future-projection` API: 将来見込みデータを提供（実装済みだが0件問題あり）

## 4. 実装タスク (Implementation Tasks)

### 4.1 稼働者状況（現在タブ）
- [ ] 現在タブに「主要項目詳細」セクション追加
- [ ] `member-details` APIから取得したデータを使用してメンバー名表示
- [ ] 週別・項目別（新規開始、切替完了、案件終了、契約終了）にメンバーリスト表示
- [ ] 折りたたみ可能なUI実装（将来見込みと同様）

### 4.2 将来見込み実データ修正
- [ ] `future-projection` APIの実データ反映問題を調査・修正
- [ ] 実際のFirestoreデータから正しい将来見込みを算出
- [ ] メンバー詳細情報の取得・表示修正

### 4.3 UI統一性
- [ ] 現在タブと将来タブの「主要項目詳細」UIを統一
- [ ] メンバー表示形式の統一（カード形式、色分け等）
- [ ] 折りたたみ機能の統一

## 5. 修正対象ファイル (Files to Modify)
- [ ] `components/work-status/detailed-status-table.tsx`: 現在タブに主要項目詳細追加
- [ ] `app/api/work-status/future-projection/route.ts`: 実データ反映修正
- [ ] `app/api/work-status/member-details/route.ts`: 必要に応じてデータ形式調整

## 6. 実装方針 (Implementation Strategy)
1. **将来見込み実データ問題を優先修正**（影響が大きいため）
2. **現在タブに主要項目詳細セクション追加**
3. **UI統一性確保**

## 7. 進捗管理 (Progress)
- [x] 将来見込みAPI実データ修正
  - フロントエンドが期待するメンバー詳細付きデータ形式に修正
  - `FutureProjectionData`インターフェース更新
  - メンバー配列とカウントを含む構造に変更
- [x] 現在タブ主要項目詳細実装
  - `CurrentItemDetails`コンポーネント追加
  - `member-details` APIからデータ取得
  - 週別・項目別メンバー表示機能実装
  - 折りたたみ機能実装
- [x] UI統一性確保
  - 将来見込みと同様のUI構造採用
  - カード形式でメンバー情報表示
  - 色分け（新規開始：青、切替：緑、案件終了：黄、契約終了：赤）
- [ ] テスト・動作確認

## 8. 実装完了内容 (Completed Implementation)

### 8.1 将来見込みAPI修正
- **ファイル**: `app/api/work-status/future-projection/route.ts`
- **変更内容**:
  - `ProjectionData` → `FutureProjectionData`インターフェース変更
  - メンバー詳細情報（id, name, status, confidence, startDate, endDate, reason）を含む構造
  - 実際のFirestoreデータから具体的なメンバー情報を抽出
  - workHistory配列の日付変換処理修正

### 8.2 現在タブ主要項目詳細実装
- **ファイル**: `components/work-status/detailed-status-table.tsx`
- **追加内容**:
  - `CurrentItemDetails`コンポーネント
  - `currentMemberDetails`状態管理
  - `weekExpanded`週別トグル状態管理
  - `member-details` API連携
  - 週別・項目別メンバー表示UI

### 8.3 データフロー確立
- 現在タブ: `member-details` API → `CurrentItemDetails`コンポーネント
- 将来タブ: `future-projection` API → `FutureItemDetails`コンポーネント
- 両方とも実際のFirestoreデータから具体的なメンバー名を表示 